name: Update SVG assets

on:
  workflow_run:
    workflows: ["vibecheck"]
    types: [completed]

jobs:
  push-svgs:
    name: Push regenerated SVGs to PR branch
    runs-on: ubuntu-latest
    permissions:
      contents: write
    if: >
      github.event.workflow_run.event == 'pull_request' &&
      github.event.workflow_run.conclusion == 'success'
    steps:
      - uses: actions/checkout@v4
        with:
          repository: ${{ github.event.workflow_run.head_repository.full_name }}
          ref: ${{ github.event.workflow_run.head_branch }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Download SVG assets
        uses: actions/download-artifact@v4
        with:
          name: svg-assets
          path: .github/assets/
          github-token: ${{ secrets.GITHUB_TOKEN }}
          run-id: ${{ github.event.workflow_run.id }}

      - name: Commit and push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .github/assets/
          git diff --cached --quiet || (git commit -m "chore: regenerate SVG assets" && git push)
